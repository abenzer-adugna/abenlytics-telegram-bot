<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Abenlytics Club | Investing Intelligence</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Slab:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary: #1a3a5f;
      --secondary: #2c5282;
      --accent: #0e9f6e;
      --light: #f0f7ff;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(rgba(10, 25, 47, 0.9), rgba(10, 25, 47, 0.9)), 
                  url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="40" viewBox="0 0 100 40"><rect width="100" height="40" fill="%231a3a5f"/><path d="M0 20 Q 25 10, 50 20 T 100 20" stroke="%230e9f6e" fill="none" stroke-width="0.5"/><path d="M0 25 Q 25 15, 50 25 T 100 25" stroke="%23e53e3e" fill="none" stroke-width="0.5"/></svg>');
      background-size: cover;
      color: #e2e8f0;
      min-height: 100vh;
    }
    
    .candlestick-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300" viewBox="0 0 400 300"><rect width="400" height="300" fill="%230c162d" opacity="0.3"/><g stroke-opacity="0.1"><line x1="50" y1="250" x2="100" y2="150" stroke="%230e9f6e" stroke-width="10"/><line x1="100" y1="150" x2="100" y2="200" stroke="%230e9f6e" stroke-width="10"/><line x1="150" y1="200" x2="200" y2="100" stroke="%23e53e3e" stroke-width="10"/><line x1="200" y1="100" x2="200" y2="180" stroke="%23e53e3e" stroke-width="10"/><line x1="250" y1="180" x2="300" y2="120" stroke="%230e9f6e" stroke-width="10"/><line x1="300" y1="120" x2="300" y2="200" stroke="%230e9f6e" stroke-width="10"/></g></svg>');
      background-size: 1200px 900px;
      opacity: 0.4;
      z-index: -1;
    }
    
    .card {
      background: rgba(26, 58, 95, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(46, 91, 140, 0.5);
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      border-color: rgba(14, 159, 110, 0.7);
    }
    
    .service-card {
      height: 100%;
    }
    
    .book-card {
      background: rgba(20, 40, 70, 0.6);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(46, 91, 140, 0.3);
      border-radius: 10px;
      padding: 1.25rem;
      transition: all 0.3s ease;
    }
    
    .book-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border-color: rgba(14, 159, 110, 0.5);
    }
    
    .crypto-card {
      background: rgba(15, 30, 50, 0.85);
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .crypto-card:hover {
      transform: scale(1.02);
      background: rgba(20, 40, 65, 0.9);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #0b8457);
      color: white;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #0b8457, var(--accent));
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(14, 159, 110, 0.3);
    }
    
    .hamburger-menu {
      background: rgba(15, 30, 50, 0.95);
      backdrop-filter: blur(10px);
    }
    
    .price-up {
      color: #0e9f6e;
    }
    
    .price-down {
      color: #e53e3e;
    }
    
    h1, h2, h3, h4 {
      font-family: 'Roboto Slab', serif;
      font-weight: 600;
    }
    
    .hero-content {
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .chart-container {
      height: 200px;
      background: rgba(10, 25, 47, 0.6);
      border-radius: 8px;
      overflow: hidden;
    }
    
    .chart-line {
      stroke-width: 2;
      fill: none;
    }
    
    .chart-up {
      stroke: #0e9f6e;
    }
    
    .chart-down {
      stroke: #e53e3e;
    }
    
    .hidden {
      display: none;
    }
    
    .spinner {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Review modal styles */
    .review-modal {
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
    }
    
    .review-content {
      max-height: 80vh;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="candlestick-bg"></div>
  
  <!-- Navbar -->
  <nav class="fixed top-0 left-0 right-0 bg-gray-900 bg-opacity-80 backdrop-filter backdrop-blur-lg z-50 p-4 flex justify-between items-center border-b border-gray-700">
    <div class="flex items-center">
      <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center mr-3">
        <i class="fas fa-chart-line text-white text-xl"></i>
      </div>
      <h1 class="text-xl md:text-2xl font-bold bg-gradient-to-r from-cyan-400 to-green-400 bg-clip-text text-transparent">Abenlytics Club</h1>
    </div>
    
    <div class="hidden md:flex space-x-6 items-center">
      <a href="#crypto" class="hover:text-cyan-300 transition">Live Crypto</a>
      <a href="#services" class="hover:text-cyan-300 transition">Services</a>
      <button class="btn-primary px-4 py-2 font-medium">Join Club</button>
    </div>
    
    <button id="menuBtn" class="md:hidden text-gray-300">
      <i class="fas fa-bars text-2xl"></i>
    </button>
  </nav>

  <!-- Hamburger Menu -->
  <div id="dropdownMenu" class="fixed top-16 right-4 w-64 bg-gray-800 bg-opacity-90 backdrop-filter backdrop-blur-lg rounded-lg shadow-xl z-50 p-4 hidden transition-all duration-300 transform origin-top-right hamburger-menu">
    <div class="text-center mb-4">
      <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center mx-auto mb-2">
        <i class="fas fa-chart-line text-white text-2xl"></i>
      </div>
      <h3 class="font-bold text-lg">Abenlytics Club</h3>
    </div>
    
    <ul class="space-y-3">
      <li><a href="#crypto" class="block py-2 px-4 hover:bg-gray-700 rounded-lg transition"><i class="fas fa-coins mr-3 text-yellow-400"></i>Live Crypto</a></li>
      <li><a href="#services" class="block py-2 px-4 hover:bg-gray-700 rounded-lg transition"><i class="fas fa-cog mr-3 text-blue-400"></i>Services</a></li>
    </ul>
    
    <div class="mt-4 pt-4 border-t border-gray-700">
      <button class="btn-primary w-full py-2 font-medium">Join Club</button>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="pt-28 pb-20 px-4 max-w-6xl mx-auto">
    <div class="text-center max-w-3xl mx-auto hero-content">
      <h1 class="text-4xl md:text-5xl font-bold mb-6">Elevate Your <span class="bg-gradient-to-r from-cyan-400 to-green-400 bg-clip-text text-transparent">Investing IQ</span></h1>
      <p class="text-xl text-gray-300 mb-8">Professional guidance, curated resources, and strategic insights to help you navigate financial markets with confidence.</p>
      
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        <button class="btn-primary px-8 py-3 font-semibold text-lg">
          <i class="fas fa-rocket mr-2"></i>Get Started
        </button>
        <button class="px-8 py-3 font-semibold text-lg border border-cyan-500 text-cyan-300 rounded-lg hover:bg-cyan-900 transition">
          <i class="fas fa-book-open mr-2"></i>Learn More
        </button>
      </div>
    </div>
  </section>

  <!-- Live Crypto Feed -->
  <section id="crypto" class="py-12 px-4 max-w-6xl mx-auto">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl md:text-3xl font-bold">💹 Live Crypto Markets</h2>
      <div class="text-sm text-gray-400 flex items-center">
        <span id="crypto-updated">Updated just now</span>
        <button id="refresh-crypto" class="ml-2 text-cyan-400">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>
    </div>
    
    <div id="crypto-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
      <div class="text-center py-10">
        <i class="fas fa-spinner spinner text-cyan-400 text-3xl mb-4"></i>
        <p>Loading crypto data...</p>
      </div>
    </div>
  </section>

  <!-- Services Section -->
  <section id="services" class="py-16 px-4 max-w-6xl mx-auto">
    <div class="text-center mb-16">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">Premium <span class="bg-gradient-to-r from-cyan-400 to-green-400 bg-clip-text text-transparent">Investing Services</span></h2>
      <p class="text-xl text-gray-300 max-w-2xl mx-auto">Access professional resources and personalized guidance to enhance your financial journey</p>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Service 1: 1-on-1 Help -->
      <div class="card p-6 service-card">
        <div class="flex items-start mb-4">
          <div class="w-12 h-12 rounded-lg bg-blue-500 bg-opacity-20 flex items-center justify-center mr-4">
            <i class="fas fa-handshake text-blue-400 text-xl"></i>
          </div>
          <h3 class="text-xl font-bold">1-to-1 Personalized Help</h3>
        </div>
        <p class="text-gray-300 mb-4">Get tailored support and guidance on investing strategies, portfolio management, and trading techniques from experienced professionals.</p>
        <button data-service="one_on_one" class="btn-primary px-4 py-2 text-sm font-medium">
          Request Consultation
        </button>
      </div>
      
      <!-- Service 2: Essential Books -->
      <div class="card p-6 service-card">
        <div class="flex items-start mb-4">
          <div class="w-12 h-12 rounded-lg bg-purple-500 bg-opacity-20 flex items-center justify-center mr-4">
            <i class="fas fa-book text-purple-400 text-xl"></i>
          </div>
          <h3 class="text-xl font-bold">Essential Investing Books</h3>
        </div>
        <p class="text-gray-300 mb-4">Access our curated library of must-read books for investors at all levels, carefully selected to build your financial knowledge foundation.</p>
        
        <button id="toggle-books-btn" class="btn-primary px-4 py-2 text-sm font-medium mb-4">
          <i class="fas fa-book mr-2"></i>Show Books
        </button>
        
        <div id="books-container" class="hidden space-y-4"></div>
      </div>
      
      <!-- Service 3: Book Reviews -->
      <div class="card p-6 service-card">
        <div class="flex items-start mb-4">
          <div class="w-12 h-12 rounded-lg bg-yellow-500 bg-opacity-20 flex items-center justify-center mr-4">
            <i class="fas fa-star text-yellow-400 text-xl"></i>
          </div>
          <h3 class="text-xl font-bold">Book Reviews & Insights</h3>
        </div>
        <p class="text-gray-300 mb-4">Get digestible summaries and practical applications from top investing books, saving you time while delivering actionable knowledge.</p>
        <button class="btn-primary px-4 py-2 text-sm font-medium" onclick="loadReviews()">
          Read Reviews
        </button>
      </div>
      
      <!-- Service 4: Newsletter -->
      <div class="card p-6 service-card">
        <div class="flex items-start mb-4">
          <div class="w-12 h-12 rounded-lg bg-green-500 bg-opacity-20 flex items-center justify-center mr-4">
            <i class="fas fa-newspaper text-green-400 text-xl"></i>
          </div>
          <h3 class="text-xl font-bold">Weekly Investing Newsletter</h3>
        </div>
        <p class="text-gray-300 mb-4">Stay informed with our concise weekly updates featuring market trends, strategic insights, and distilled wisdom from financial literature.</p>
        <button data-service="newsletter" class="btn-primary px-4 py-2 text-sm font-medium">
          Subscribe Now
        </button>
      </div>
      
      <!-- Service 5: Roadmaps -->
      <div class="card p-6 service-card">
        <div class="flex items-start mb-4">
          <div class="w-12 h-12 rounded-lg bg-red-500 bg-opacity-20 flex items-center justify-center mr-4">
            <i class="fas fa-map text-red-400 text-xl"></i>
          </div>
          <h3 class="text-xl font-bold">Trading & Investing Roadmaps</h3>
        </div>
        <p class="text-gray-300 mb-4">Follow our actionable roadmaps for different investment styles: long-term wealth building, swing trading strategies, and short-term opportunities.</p>
        <button class="btn-primary px-4 py-2 text-sm font-medium" onclick="loadServiceData('roadmaps')">
          View Roadmaps
        </button>
      </div>
      
      <!-- Service 6: Prospectus -->
      <div class="card p-6 service-card">
        <div class="flex items-start mb-4">
          <div class="w-12 h-12 rounded-lg bg-cyan-500 bg-opacity-20 flex items-center justify-center mr-4">
            <i class="fas fa-file-alt text-cyan-400 text-xl"></i>
          </div>
          <h3 class="text-xl font-bold">Prospectus Review Service</h3>
        </div>
        <p class="text-gray-300 mb-4">Get simplified analysis of complex company filings for IPOs and public companies, highlighting key information to inform your investment decisions.</p>
        <button data-service="prospectus" class="btn-primary px-4 py-2 text-sm font-medium">
          Request Review
        </button>
      </div>
      
      <!-- Service 7: Group Access -->
      <div class="card p-6 service-card">
        <div class="flex items-start mb-4">
          <div class="w-12 h-12 rounded-lg bg-pink-500 bg-opacity-20 flex items-center justify-center mr-4">
            <i class="fas fa-users text-pink-400 text-xl"></i>
          </div>
          <h3 class="text-xl font-bold">Investor Community</h3>
        </div>
        <p class="text-gray-300 mb-4">Join our exclusive community of like-minded investors to share insights, discuss strategies, and network with fellow financial enthusiasts.</p>
        <button data-service="group_access" class="btn-primary px-4 py-2 text-sm font-medium">
          Join Community
        </button>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-16 px-4">
    <div class="max-w-4xl mx-auto card p-8 text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">Ready to Elevate Your <span class="bg-gradient-to-r from-cyan-400 to-green-400 bg-clip-text text-transparent">Investing Journey?</span></h2>
      <p class="text-xl text-gray-300 mb-8">Join Abenlytics Club today and unlock premium resources and personalized guidance</p>
      
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        <button class="btn-primary px-8 py-3 font-semibold text-lg">
          <i class="fas fa-gem mr-2"></i>Premium Membership
        </button>
        <button class="px-8 py-3 font-semibold text-lg border border-cyan-500 text-cyan-300 rounded-lg hover:bg-cyan-900 transition">
          <i class="fas fa-book mr-2"></i>Free Resources
        </button>
      </div>
    </div>
  </section>

  <!-- Consultation Modal -->
  <div id="consultation-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
    <div class="bg-gray-800 rounded-lg w-full max-w-md p-6">
      <h3 class="text-xl font-bold mb-4">📞 Request 1-on-1 Consultation</h3>
      
      <div class="mb-4">
        <label class="block text-gray-300 mb-2">Your Telegram Username</label>
        <input 
          type="text" 
          id="telegram-username" 
          class="w-full bg-gray-700 text-white p-2 rounded" 
          placeholder="@yourusername" 
          required
        >
      </div>
      
      <div class="mb-4">
        <label class="block text-gray-300 mb-2">Describe Your Problem</label>
        <textarea 
          id="problem-description" 
          class="w-full bg-gray-700 text-white p-2 rounded h-32" 
          placeholder="What investment challenges are you facing?" 
          required
        ></textarea>
      </div>
      
      <div class="flex justify-end space-x-3">
        <button id="consultation-cancel" class="px-4 py-2 border border-gray-600 rounded hover:bg-gray-700">
          Cancel
        </button>
        <button id="consultation-submit" class="btn-primary px-4 py-2">
          Submit Request
        </button>
      </div>
    </div>
  </div>

  <!-- Prospectus Upload Modal -->
  <div id="prospectus-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
    <div class="bg-gray-800 rounded-lg w-full max-w-md p-6">
      <h3 class="text-xl font-bold mb-4">📄 Upload Prospectus</h3>
      
      <div class="mb-4">
        <label class="block text-gray-300 mb-2">Select File (PDF/DOC/DOCX)</label>
        <input type="file" id="prospectus-file" class="w-full bg-gray-700 text-white p-2 rounded" accept=".pdf,.doc,.docx">
      </div>
      
      <div class="flex justify-end space-x-3">
        <button id="prospectus-cancel" class="px-4 py-2 border border-gray-600 rounded hover:bg-gray-700">
          Cancel
        </button>
        <button id="prospectus-submit" class="btn-primary px-4 py-2">
          Submit
        </button>
      </div>
    </div>
  </div>

  <!-- Review Modal -->
  <div id="review-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 review-modal">
    <div class="bg-gray-800 rounded-lg w-full max-w-2xl p-6 review-content">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-2xl font-bold">📚 Book Reviews & Insights</h3>
        <button id="close-review-modal" class="text-gray-400 hover:text-white">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div id="reviews-container" class="space-y-4">
        <!-- Reviews will be inserted here -->
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="py-10 px-4 border-t border-gray-800">
    <div class="max-w-6xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center mb-4">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-400 flex items-center justify-center mr-3">
              <i class="fas fa-chart-line text-white"></i>
            </div>
            <h3 class="text-xl font-bold">Abenlytics Club</h3>
          </div>
          <p class="text-gray-400 mb-4">Your trusted partner in financial education and investment strategy.</p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-cyan-400"><i class="fab fa-twitter"></i></a>
            <a href="#" class="text-gray-400 hover:text-cyan-400"><i class="fab fa-linkedin"></i></a>
            <a href="#" class="text-gray-400 hover:text-cyan-400"><i class="fab fa-telegram"></i></a>
          </div>
        </div>
        
        <div>
          <h4 class="text-lg font-bold mb-4">Services</h4>
          <ul class="space-y-2">
            <li><a href="#services" class="text-gray-400 hover:text-cyan-400">1-to-1 Help</a></li>
            <li><a href="#services" class="text-gray-400 hover:text-cyan-400">Essential Books</a></li>
            <li><a href="#services" class="text-gray-400 hover:text-cyan-400">Book Reviews</a></li>
            <li><a href="#services" class="text-gray-400 hover:text-cyan-400">Weekly Newsletter</a></li>
          </ul>
        </div>
        
        <div>
          <h4 class="text-lg font-bold mb-4">Resources</h4>
          <ul class="space-y-2">
            <li><a href="#services" class="text-gray-400 hover:text-cyan-400">Trading Roadmaps</a></li>
            <li><a href="#services" class="text-gray-400 hover:text-cyan-400">Prospectus Review</a></li>
            <li><a href="#services" class="text-gray-400 hover:text-cyan-400">Investor Community</a></li>
            <li><a href="#crypto" class="text-gray-400 hover:text-cyan-400">Market Analysis</a></li>
          </ul>
        </div>
        
        <div>
          <h4 class="text-lg font-bold mb-4">Contact Us</h4>
          <ul class="space-y-2">
            <li class="text-gray-400"><i class="fas fa-envelope mr-2"></i> support@abenlytics.com</li>
            <li class="text-gray-400"><i class="fab fa-telegram mr-2"></i> @abenlytics_support</li>
          </ul>
        </div>
      </div>
      
      <div class="border-t border-gray-800 mt-10 pt-6 text-center text-gray-500">
        <p>&copy; 2025 Abenlytics Club. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    // Mobile menu toggle
    document.getElementById('menuBtn').addEventListener('click', function() {
      const dropdownMenu = document.getElementById('dropdownMenu');
      dropdownMenu.classList.toggle('hidden');
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', function(event) {
      const dropdownMenu = document.getElementById('dropdownMenu');
      const menuBtn = document.getElementById('menuBtn');
      
      if (!dropdownMenu.contains(event.target) && event.target !== menuBtn) {
        dropdownMenu.classList.add('hidden');
      }
    });

    // Telegram user functions
    async function getTelegramUser() {
      if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
        const user = window.Telegram.WebApp.initDataUnsafe.user;
        return {
          id: user.id,
          first_name: user.first_name || '',
          last_name: user.last_name || '',
          username: user.username || '',
          language_code: user.language_code || 'en'
        };
      }
      return null;
    }
    
    function getTelegramUserSync() {
      if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
        const user = window.Telegram.WebApp.initDataUnsafe.user;
        return {
          id: user.id,
          first_name: user.first_name || '',
          last_name: user.last_name || '',
          username: user.username || ''
        };
      }
      return null;
    }

    // Service request handler
    async function requestService(serviceType, data = null, formData = null) {
      try {
        let user, userName;
        
        if (serviceType === 'one_on_one' && data) {
          user = { id: data.userData.id };
          userName = data.userData.name;
        } else {
          const telegramUser = await getTelegramUser() || {
            id: Math.floor(Math.random() * 1000000),
            first_name: "Test",
            last_name: "User"
          };
          user = telegramUser;
          userName = `${telegramUser.first_name} ${telegramUser.last_name}`.trim();
        }

        let response;
        
        if (serviceType === 'prospectus' && formData) {
          formData.append('userData', JSON.stringify({
            id: user.id,
            name: userName
          }));
          
          response = await fetch('/api/service/prospectus', {
            method: 'POST',
            body: formData
          });
        } else {
          const body = serviceType === 'one_on_one' 
            ? { ...data } 
            : {
                userData: {
                  id: user.id,
                  name: userName
                }
              };
          
          response = await fetch(`/api/service/${serviceType}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(body)
          });
        }
        
        const result = await response.json();
        
        if (result.status === 'success') {
          alert(`✅ ${serviceType.replace(/_/g, ' ')} request successful!`);
          if (serviceType === 'group_access' && result.link) {
            window.open(result.link, '_blank');
          }
        } else {
          alert(`❌ Error: ${result.message}`);
        }
        
        return result;
      } catch (error) {
        console.error('Service error:', error);
        alert('❌ Network error. Please try again.');
        return { status: 'error', message: 'Network error' };
      }
    }

    // Handle consultation request
    function handleConsultationRequest() {
      const usernameInput = document.getElementById('telegram-username');
      const problemInput = document.getElementById('problem-description');
      
      const telegramUsername = usernameInput.value.trim();
      const problem = problemInput.value.trim();
      
      if (!telegramUsername || !problem) {
        alert('Please provide both your Telegram username and problem description');
        return;
      }
      
      // Get user data
      const user = getTelegramUserSync() || {
        id: Math.floor(Math.random() * 1000000),
        first_name: "User",
        last_name: ""
      };
      
      requestService('one_on_one', {
        telegramUsername,
        problem,
        userData: {
          id: user.id,
          name: `${user.first_name} ${user.last_name}`.trim() || "Anonymous User"
        }
      });
      
      // Reset form and close modal
      usernameInput.value = '';
      problemInput.value = '';
      document.getElementById('consultation-modal').classList.add('hidden');
    }

    // Prospectus upload handler
    function handleProspectusUpload() {
      const fileInput = document.getElementById('prospectus-file');
      if (!fileInput.files.length) return alert('Please select a file');
      
      const formData = new FormData();
      formData.append('prospectus', fileInput.files[0]);
      requestService('prospectus', null, formData);
      
      // Reset form and close modal
      fileInput.value = '';
      document.getElementById('prospectus-modal').classList.add('hidden');
    }

    // Function to load books
    async function loadBooks() {
      try {
        const container = document.getElementById('books-container');
        const toggleBtn = document.getElementById('toggle-books-btn');
        
        // Show loading state
        container.innerHTML = `
          <div class="text-center py-4">
            <i class="fas fa-spinner spinner text-cyan-400 text-xl"></i>
            <p class="mt-2">Loading books...</p>
          </div>
        `;
        container.classList.remove('hidden');
        
        // Fetch books
        const response = await fetch('/api/books');
        const result = await response.json();
        
        if (result.status === 'success') {
          // Render books
          container.innerHTML = result.books.map(book => `
            <div class="book-card">
              <h4 class="font-bold text-lg mb-2">${book.title}</h4>
              <div class="text-gray-400 mb-2">By ${book.author}</div>
              <p class="mb-3">${book.description}</p>
              <a href="/data/books/${book.file}" 
                 class="btn-primary inline-block px-3 py-1 text-sm"
                 download="${book.title}.pdf">
                <i class="fas fa-download mr-1"></i>Download
              </a>
            </div>
          `).join('');
          
          // Update button text
          toggleBtn.innerHTML = '<i class="fas fa-eye-slash mr-2"></i>Hide Books';
        } else {
          throw new Error('Failed to load books');
        }
      } catch (error) {
        const container = document.getElementById('books-container');
        container.innerHTML = `
          <div class="text-center py-4 text-red-400">
            <i class="fas fa-exclamation-triangle text-xl mb-2"></i>
            <p>Error loading books. Please try again.</p>
          </div>
        `;
      }
    }

    // Toggle books visibility
    function toggleBooks() {
      const container = document.getElementById('books-container');
      const btn = document.getElementById('toggle-books-btn');
      
      if (container.classList.contains('hidden')) {
        loadBooks();
        btn.innerHTML = '<i class="fas fa-eye-slash mr-2"></i>Hide Books';
      } else {
        container.classList.add('hidden');
        btn.innerHTML = '<i class="fas fa-book mr-2"></i>Show Books';
      }
    }

    // Load reviews
    async function loadReviews() {
      try {
        // Show loading state
        const modal = document.getElementById('review-modal');
        const container = document.getElementById('reviews-container');
        container.innerHTML = `
          <div class="text-center py-8">
            <i class="fas fa-spinner spinner text-cyan-400 text-2xl"></i>
            <p class="mt-2">Loading reviews...</p>
          </div>
        `;
        modal.classList.remove('hidden');
        
        // Fetch reviews
        const response = await fetch('/api/reviews');
        const result = await response.json();
        
        if (result.status === 'success') {
          // Render reviews
          container.innerHTML = result.reviews.map(review => `
            <div class="bg-gray-700 p-4 rounded-lg">
              <h4 class="font-bold text-lg mb-2">${review.title}</h4>
              <div class="flex items-center mb-2">
                ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}
                <span class="ml-2 text-yellow-400">${review.rating}/5</span>
              </div>
              <p class="mb-3"><strong>Summary:</strong> ${review.summary}</p>
              <p><strong>Key Insights:</strong> ${review.keyInsights.join(', ')}</p>
            </div>
          `).join('');
        } else {
          throw new Error('Failed to load reviews');
        }
      } catch (error) {
        const container = document.getElementById('reviews-container');
        container.innerHTML = `
          <div class="text-center py-8 text-red-400">
            <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
            <p>Error loading reviews. Please try again.</p>
          </div>
        `;
      }
    }

    // Newsletter subscription
    async function subscribeNewsletter() {
      try {
        const user = await getTelegramUser() || {
          id: Date.now(),
          first_name: "User",
          last_name: ""
        };
        
        const response = await fetch('/api/service/newsletter', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            userData: {
              id: user.id,
              name: `${user.first_name} ${user.last_name}`.trim() || "Anonymous User"
            }
          })
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
          alert('🎉 You have successfully subscribed to our newsletter!');
        } else {
          alert('⚠️ ' + (result.message || 'Subscription failed. Please try again.'));
        }
      } catch (error) {
        console.error('Newsletter subscription error:', error);
        alert('❌ Network error. Please try again.');
      }
    }

    // Fetch live crypto data from CoinGecko
    async function fetchCryptoData() {
      try {
        const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=bitcoin,ethereum,solana,cardano&per_page=4');
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Crypto data error:', error);
        return [];
      }
    }

    // Generate SVG path from price data
    function generateSparklinePath(prices) {
      if (!prices || prices.length < 2) return '';
      
      const max = Math.max(...prices);
      const min = Math.min(...prices);
      const range = max - min || 1;
      
      const points = prices.map((price, i) => {
        const x = (i / (prices.length - 1)) * 300;
        const y = 80 - ((price - min) / range) * 70;
        return `${x},${y}`;
      });
      
      return `M${points.join(' L')}`;
    }

    // Update crypto prices
    async function updateCryptoPrices() {
      try {
        const cryptoData = await fetchCryptoData();
        const container = document.getElementById('crypto-container');
        
        if (!cryptoData || cryptoData.length === 0) {
          container.innerHTML = `
            <div class="col-span-4 text-center py-10 text-red-400">
              <i class="fas fa-exclamation-triangle text-3xl mb-4"></i>
              <p>Failed to load crypto data. Please try again later.</p>
            </div>
          `;
          return;
        }
        
        container.innerHTML = cryptoData.map(crypto => {
          const change = crypto.price_change_percentage_24h;
          const isUp = change >= 0;
          const iconClass = {
            bitcoin: 'fab fa-bitcoin text-yellow-400',
            ethereum: 'fab fa-ethereum text-purple-400',
            solana: 'fas fa-coins text-cyan-400',
            cardano: 'fas fa-chart-line text-blue-400'
          }[crypto.id] || 'fas fa-coins text-gray-400';
          
          // Generate sparkline path
          const sparklinePath = crypto.sparkline_in_7d?.price 
            ? generateSparklinePath(crypto.sparkline_in_7d.price.slice(0, 20))
            : '';
            
          return `
            <div class="crypto-card p-5" data-crypto="${crypto.id}">
              <div class="flex justify-between items-start mb-4">
                <div class="flex items-center">
                  <div class="w-10 h-10 rounded-full bg-opacity-20 flex items-center justify-center mr-3">
                    <i class="${iconClass} text-lg"></i>
                  </div>
                  <div>
                    <h3 class="font-bold">${crypto.name}</h3>
                    <div class="text-sm text-gray-400">${crypto.symbol.toUpperCase()}/USD</div>
                  </div>
                </div>
                <div class="${isUp ? 'price-up' : 'price-down'} text-lg font-bold">
                  $${crypto.current_price.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                </div>
              </div>
              
              <div class="flex justify-between items-center mb-3">
                <div class="text-sm">24h Change</div>
                <div class="${isUp ? 'price-up' : 'price-down'}">
                  ${isUp ? '+' : ''}${change.toFixed(2)}% 
                  <i class="fas fa-arrow-${isUp ? 'up' : 'down'} ml-1"></i>
                </div>
              </div>
              
              <div class="chart-container">
                <svg viewBox="0 0 300 80" class="w-full h-full">
                  <path class="chart-line ${isUp ? 'chart-up' : 'chart-down'}" d="${sparklinePath}"></path>
                </svg>
              </div>
            </div>
          `;
        }).join('');
        
        // Update timestamp
        document.getElementById('crypto-updated').textContent = 
          `Updated: ${new Date().toLocaleTimeString()}`;
          
      } catch (error) {
        console.error('Crypto update error:', error);
      }
    }

    // Initialize services
    document.addEventListener('DOMContentLoaded', () => {
      // Add service handlers
      document.querySelectorAll('[data-service]').forEach(button => {
        button.addEventListener('click', function() {
          const serviceType = button.dataset.service;
          
          if (serviceType === 'prospectus') {
            document.getElementById('prospectus-modal').classList.remove('hidden');
          } else if (serviceType === 'one_on_one') {
            document.getElementById('consultation-modal').classList.remove('hidden');
            
            // Pre-fill Telegram username if available
            const user = getTelegramUserSync();
            if (user && user.username) {
              document.getElementById('telegram-username').value = `@${user.username}`;
            }
          } else if (serviceType === 'newsletter') {
            subscribeNewsletter();
          } else if (serviceType === 'group_access') {
            requestService('group_access');
          }
        });
      });
      
      // Book toggle button
      document.getElementById('toggle-books-btn').addEventListener('click', toggleBooks);
      
      // Prospectus modal handling
      document.getElementById('prospectus-submit').addEventListener('click', handleProspectusUpload);
      document.getElementById('prospectus-cancel').addEventListener('click', () => {
        document.getElementById('prospectus-modal').classList.add('hidden');
      });
      
      // Consultation modal handling
      document.getElementById('consultation-submit').addEventListener('click', handleConsultationRequest);
      document.getElementById('consultation-cancel').addEventListener('click', () => {
        document.getElementById('consultation-modal').classList.add('hidden');
      });
      
      // Review modal handling
      document.getElementById('close-review-modal').addEventListener('click', () => {
        document.getElementById('review-modal').classList.add('hidden');
      });
      
      // Crypto refresh button
      document.getElementById('refresh-crypto').addEventListener('click', () => {
        document.getElementById('refresh-crypto').classList.add('spinner');
        updateCryptoPrices().finally(() => {
          document.getElementById('refresh-crypto').classList.remove('spinner');
        });
      });
      
      // Load crypto data
      updateCryptoPrices();
      
      // Update crypto prices periodically
      setInterval(updateCryptoPrices, 60000);
      
      // Close modal when clicking outside
      document.addEventListener('click', (e) => {
        const modals = [
          'consultation-modal',
          'prospectus-modal',
          'review-modal'
        ];
        
        modals.forEach(id => {
          const modal = document.getElementById(id);
          if (e.target === modal) {
            modal.classList.add('hidden');
          }
        });
      });
    });
  </script>
</body>
                                                                </html>
